
sudo dnf install -y nginx nginx-mod-stream policycoreutils-python-utils


sudo mkdir -p /etc/nginx/tcpconf.d


echo 'include /etc/nginx/tcpconf.d/*;' | sudo tee -a /etc/nginx/nginx.conf >/dev/null


cat << EOF | sudo tee /etc/nginx/tcpconf.d/kubernetes.conf
stream {
  upstream kubernetes {
    server 192.168.100.174:6443;
    server 192.168.100.168:6443;
  }

  server {
    listen 6443;
    listen 443;
    proxy_pass kubernetes;
  }
}
EOF


sudo semanage port -a -t http_port_t  -p tcp 6443


sudo systemctl restart nginx




